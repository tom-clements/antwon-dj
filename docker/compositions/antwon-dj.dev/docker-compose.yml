version: "3.9"

services:
    backend:
        image: antwon-dj/dev.backend
        container_name: antwon-dj.dev_backend
        build:
            context: ../../../backend
            dockerfile: dev.Dockerfile
        command: chalice local --stage local --host=0.0.0.0 --port=8000
        networks:
            - internal-network
        ports:
            - 8000:8000
        volumes:
            - ../../../.aws.config:/root/.aws/config:ro
            - ../../../backend/app.py:/backend/app.py
            - ../../../backend/chalicelib:/backend/chalicelib

    client:
        image: antwon-dj/dev.client
        container_name: antwon-dj.dev_client
        build:
            context: ../../../client
            dockerfile: dev.Dockerfile
        command: yarn dev
        networks:
            - internal-network
        ports:
            - 3000:3000
        volumes:
            - ../../../client/src:/client/src
            - ../../../client/test:/client/test

    client-storybook:
        image: antwon-dj/dev.client-storybook
        container_name: antwon-dj.dev_client-storybook
        build:
            context: ../../../client
            dockerfile: dev.Dockerfile
        command: yarn storybook
        networks:
            - internal-network
        ports:
            - 3001:3001
        volumes:
            - ../../../client/src:/client/src
            - ../../../client/test:/client/test

networks:
    internal-network:
        driver: bridge
